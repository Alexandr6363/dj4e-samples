{% extends 'base_bootstrap.html' %}
{% block content %}
<p>Lets get some JSON using promise syntax.  Turn on your developer console and press the buttons below:</p>
<p>
<button onclick="loadUrl('hddp://x/broken', 'urlfail');return false;">URL Fail</button>
</p>
<p id="urlfail">New text will not go here</span></p>
<p>
<button onclick="loadUrl('/broken', 'response');return false;">Response Fail</button>
</p>
<p id="response">New text will not go here</span></p>
<p>
<button onclick="loadUrl('{% url 'chat:jsonfun' %}', 'working');return false;">Retrieve Data</button>
</p>
<p id="working">New text will go here!!!!</span></p>
<script type="text/javascript">

function loadUrl(url, id) {
    console.log("Loading", url);
    document.getElementById(id).style.color = 'orange';
    document.getElementById(id).innerHTML = 'Loading...';

    fetch(url, {cache: "no-store"})
        .catch((error) => alert('Fetch error\n'+error) )
      .then((response) => response.json())
          .catch((error) => alert('Parsing error\n'+error))
      .then((data) => {
        console.log('JSON data', data);
        document.getElementById(id).style.color = 'green';
        document.getElementById(id).innerHTML = 'Promise: ' + data.first;
    });
}

</script>
{% endblock %}
</body>
